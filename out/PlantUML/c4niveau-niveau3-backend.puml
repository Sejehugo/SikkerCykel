@startuml c4niveau-niveau3-backend
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component Diagram for SikkerCykel App

top to bottom direction

skinparam {
  arrowFontSize 10
  defaultTextAlignment center
  wrapWidth 200
  maxMessageSize 100
}

hide stereotype

skinparam person<<SystemAdminstrator>> {
  BackgroundColor #lightgrey
  FontColor #black
  BorderColor #052e56
  shadowing false
}
skinparam person<<AnonymousUser>> {
  BackgroundColor #08427b
  FontColor #ffffff
  BorderColor #052e56
  shadowing false
}
skinparam rectangle<<ExternalSystem>> {
  BackgroundColor #1168bd
  FontColor #ffffff
  BorderColor #0b4884
  shadowing false
}
skinparam rectangle<<SikkerCykelSystem>> {
  BackgroundColor #1168bd
  FontColor #ffffff
  BorderColor #0b4884
  shadowing false
}
skinparam person<<User>> {
  BackgroundColor #08427b
  FontColor #ffffff
  BorderColor #052e56
  shadowing false
}

skinparam rectangle<<GrayBox>> {
  BackgroundColor #707070
  FontColor #ffffff
  BorderColor #505050
  shadowing false
}

Person(user, "Cykelejer", "En cykelejer af SikkerCykel Appen har ejerskabsbevis for sine cykler")

Container(ui, "Brugergrænseflade (UI)", "Flutter", "Grænseflade for cykelejer til at administrere cykler")

System_Boundary(c1, "SikkerCykel System") {
    Container(controller, "CykelController", "ASP.NET Core Controller", "Håndterer input fra UI og sender anmodninger til SikkerCykel API")
    Container(service, "CykelService", "Service", "Forretningslogik til at registrere, spore og administrere cykler")
    Container(email, "EmailService", "MailKit", "Sender emails ved ejerskabshændelser og kontoadministration")
    Container(notification, "NotificationService", "Service", "Håndterer push-notifikationer, når DM-kode scannes")
}

ContainerDb(register, "SikkerCykel Register", "PostgreSQL", "Gemmer cykeldata, ejerskabsinformation og brugeroplysninger")

' ' Eksterne systemer
rectangle "==Emailsystem\n<size:10>[Eksternt system]</size>\n\nSender systemgenererede emails som nulstilling af adgangskoder" <<GrayBox>> as email_ext
rectangle "==Notifikationssystem\n<size:10>[Eksternt system]</size>\n\nSender notifikationer til brugere om cykelstatus og ejerskabshændelser" <<GrayBox>> as notification_ext

' ' Relationer mellem komponenter i appen
Rel(user, ui, "Interagerer med via mobil app")
Rel(ui, controller, "Sender input til")
Rel(controller, service, "Kalder forretningslogik")
Rel(service, register, "Læser/skriv data fra/til SikkerCykel Register")
Rel(service, email, "Bruger til at sende ejerskabsmails")
Rel(service, notification, "Bruger til at sende push-notifikationer")

' ' Eksterne relationer
Rel(email, email_ext, "Sender emails via")
Rel(notification, notification_ext, "Sender notifikationer via")

@enduml
